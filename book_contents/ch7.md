# Chapter 7. 도메인 서비스

## 7.1 여러 애그리거트가 필요한 기능
* 한 애그리거트로 기능을 구현할 수 없을 때 여러 애그리거트에 걸친 데이터가 필요하다
* 이 때 어느 애그리커드에서 기능을 구현해야 할까?
* 기능을 구현한 애그리거트와 관련이 없는 정책이 추가되어도 해당 애그리거트의 코드를 수정해야한다
* 이렇게 한 애그리거트에 넣기 애매한 도메인 기능을 억지로 특정 애그리거트에 구현하면 안 된다.
	* 억지구현시 책임범위를 넘어서는 기능구현
	* 코드가 길어지고 외부에 대한 의존이 높아짐
	* 코드가 복잡해지면서 수정이 어려워진다
	* 애그리거트의 범위를 넘어서는 도메인 개념이 애그리거트에 숨어들어 명시적으로 드러나지 않게 된다.

* 도메인 기능을 별도 서비스로 구현!

## 7.2 도메인 서비스
* 도메인 영역에 위치한 도메인 로직을 표현할 때 사용
	* 계산 로직 : 여러 애그리거트가 필요한 계산 로직이나 한 애그리거트에 넣기에는 다소 복잡한 계산로직
	* 외부 시스템 연동이 필요한 도메인 로직 : 구현하기 위해 타 시스템을 사용해야하는 도메인 로직
	
### 7.2.1 계산 로직과 도메인 서비스
* 응용영역의 서비스가 응용 로직을 다룬다면 도메인 서비스는 도메인 로직을 다룬다.
* 도메인 영역의 애그리거트나 밸로같은 구성요소와 도메인 서비스의 차이점
	* 서비스에는 상태 없이 로직만 구현한다.
	* 구현에 필요한 상태는 다른 방법으로 전달받는다.
* 도메인의 의미가 드러나는 용어를 타입과 메서드 이름으로 갖는다.
* 서비스의 사용주체는 애그리거트/응용 서비스 둘 다 될 수 있다.
	* 애그리거트가 사용주체인 경우 애그리거트 객체에 도메인 서비스를 전달하는 것은 응용서비스의 책임이다.
	* 도메인 서비스 객체를 애그리거트에 주입해서는 안된다.
		* 애그리거트 메서드 실행시 도메인 서비스 객체를 파라미터로 전달
			* 애그리거트가 도메인 서비스에 의존
			* 의존성 주입으로 처리하고 싶은 욕망이 들수 있고 기술적으로 나은것 같은 착각을 하게 된다.
				* 도메인 객체는 필드로 구성된 데이터와 메서드를 이용해서 개념적으로 하나인 모델을 표현
				* 도메인 서비스 객체의 필드는 데이터자체와는 관련이 없고 저장대상도 아니다.
				* 애그리거트의 모든 기능에서 해당 서비스를 필요로 하는것도 아니다.
				* 일부 기능을 위해 굳이 도메인 서비스를 의존주입할 이유는 없다.
	* 애그리거트 메서드 실행시 서비스를 인자로 전달하지 않고 반대로 도메인서비스 기능 실행시 애그리거트를 전달하기도 한다.
		* ex) 계좌이체 같은 경우 두 계좌 애그리거트를 서비스로 전달해서 각 애그리거트의 기능을 조작한다.
* 응용서비스는 애그리거트를 구한 뒤 해당 도메인 영역의 서비스를 이용해서 도메인 기능을 실행한다.
* 특정 기능이 응용서비스인지 도메인 서비스인지 감을 잡기 어려운 경우
	* 해당 로직이 애그리거트의 상태를 변경하거나 애그리거트의 상태값을 계산하는지 확인한다. 
	* 맞다면 도메인 로직이고 한 애그리거트에 적합하지 않은 경우 도메인 서비스로 구현하게 된다.
	
### 7.2.2 외부 시스템 연동과 도메인 서비스
* 외부 시스템이나 타 도메인과의 연동기능도 도메인 서비스가 될 수 있다.
* ex) 설문조사 시스템과 사용자 역할 관리 시스템이 분리되어 있는 경우 연동이 필요
	* 설문조사 도메인 입장에서는 사용자가 설문조사 생성권한을 가졌는지 확인하는 도메인 로직
	* 중요한 점은 역할 관리시스템과 연동한다는 관점으로 인터페이스를 작성하는 것이 아니라 도메인 로직 관점에서 인터페이스를 작성하는 것.
	* 인터페이스를 구현한 클래스는 인프라 스트럭쳐 영역에서 연동을 포함한 권한 검사 기능을 구현한다.(외부 연동이므로 인프라 영역에서)

### 7.2.3 도메인 서비스의 패키지 위치
* 서비스는 도메인 로직을 표현하므로 다른 도메인 구성요소와 동일한 패키지에 위치한다.
* 서비스의 개수가 많거나 엔티티나 밸류와 같은 다른 ㅇ구성요소와 명시적으로 구분하고 싶다면
	* domain.model
	* domain.service
	* domain.repository 
	처럼 하위 패키지를 구분하여 위치시킨다.
	
### 7.2.4 도메인 서비스의 인터페이스와 클래스
* 로직이 고정되어있지 않은 경우 서비스 자체를 인터페이스로 구현하고 이를 구현한 클래스를 둘 수도 있다.
* 특히 외부시스템이나 별도엔진을 이용해서 구현하는 경우 
	* 도메인 영역에 도메인 서비스 인터페이스를 위치하고 구현은 인프라 영역에 위치한다.
